(()=>{"use strict";const e=document.querySelector("#card-template").content,t=(t,r,o,s)=>{const n=e.querySelector(".places__item").cloneNode(!0),a=n.querySelector(".card__image"),c=n.querySelector(".card__title"),l=n.querySelector(".card__like-count");return c.textContent=r,a.src=t,a.alt=r,l.textContent=o,n.id=s,n},r=(e,t,r,o)=>{const s=e.querySelector(`.${t.name}-error`);t.classList.remove(r),s.classList.remove(o),s.textContent=""},o=(e,t,o)=>{t.validity.valid?r(e,t,o.inputErrorClass,o.errorClass):((e,t,r,o,s)=>{const n=e.querySelector(`.${t.name}-error`);t.classList.add(r),n.classList.add(s),n.textContent=o})(e,t,o.inputErrorClass,t.validationMessage,o.errorClass)},s=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);n(r,s,t.inactiveButtonClass),r.forEach((r=>{o(e,r,t)}))},n=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?t.classList.add(r):t.classList.remove(r)};function a(e){"Escape"===e.key&&_(document.querySelector(".popup_is-opened"))}let c=!1;function l(e){c=e.target===e.currentTarget}function i(e){e.target!==e.currentTarget&&(c=!1)}function u(e){e.target===e.currentTarget&&(e.target.style.cursor="pointer")}function d(e){e.target===e.currentTarget&&(e.target.style.cursor="default")}function p(e){function t(){_(e),e.querySelector(".popup__close").removeEventListener("click",t),e.removeEventListener("click",r),e.removeEventListener("mousedown",l),e.removeEventListener("mouseup",i),e.removeEventListener("mouseover",u),e.removeEventListener("mouseout",d),document.removeEventListener("keydown",a)}function r(e){c&&e.target===e.currentTarget&&t()}e.classList.add("popup_is-opened"),e.querySelector(".popup__close").addEventListener("click",t),e.addEventListener("click",r),e.addEventListener("mousedown",l),e.addEventListener("mouseup",i),e.addEventListener("mouseover",u),e.addEventListener("mouseout",d),document.addEventListener("keydown",a)}function _(e){e.classList.remove("popup_is-opened")}const m={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"a2be7d13-6272-4de0-adf1-e1d882bb3a08","Content-Type":"application/json"}},v=document.querySelector(".places__list"),y=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),f=document.querySelector(".popup_type_avatar");y.classList.add("popup_is-animated"),h.classList.add("popup_is-animated"),S.classList.add("popup_is-animated");const b=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),E=document.querySelector(".profile__image-overlay"),q=S.querySelector(".popup__image"),C=S.querySelector(".popup__caption"),k=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),$=y.querySelector(".popup__form"),j=$.querySelector(".popup__button"),B=$.querySelector(".popup__input_type_name"),P=$.querySelector(".popup__input_type_description");B.value=b.textContent,P.value=g.textContent;const T=h.querySelector(".popup__form"),A=T.querySelector(".popup__button"),U=T.querySelector(".popup__input_type_card-name"),w=T.querySelector(".popup__input_type_url"),D=f.querySelector(".popup__form"),N=D.querySelector(".popup__button"),O=D.querySelector(".popup__input_type_url"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let J;(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);r.forEach((a=>{a.addEventListener("input",(()=>{o(e,a,t),n(r,s,t.inactiveButtonClass)}))}))})(t,e)}))})(I),v.addEventListener("click",(e=>{if(e.target.classList.contains("card__image"))q.src="",q.src=e.target.src,C.textContent=e.target.alt,p(S);else if(e.target.classList.contains("card__like-button")){e.target.disabled=!0;const t=e.target.closest(".places__item");let r;r=e.target.classList.contains("card__like-button_is-active")?"DELETE":"PUT",((e,t)=>fetch(`${m.baseUrl}/cards/likes/${e}`,{method:t,headers:m.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))))(t.id,r).then((r=>{const o=(s=t,n=r.likes.length,s.querySelector(".card__like-count").textContent=n,s);var s,n;t.replaceWith(o),e.target.classList.toggle("card__like-button_is-active")})).catch((e=>{console.log(e)})).finally((()=>{e.target.disabled=!1}))}else if(e.target.classList.contains("card__delete-button")){e.target.disabled=!0;const r=e.target.closest(".places__item");(t=r.id,fetch(`${m.baseUrl}/cards/${t}`,{method:"DELETE",headers:m.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))).then((e=>{r.remove()})).catch((e=>{console.log(e)}))}var t})),Promise.all([fetch(`${m.baseUrl}/users/me`,{headers:m.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))),fetch(`${m.baseUrl}/cards`,{headers:m.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))]).then((([e,r])=>{b.textContent=e.name,g.textContent=e.about,L.style.backgroundImage=`url(${e.avatar})`,J=e._id,r.forEach((e=>{const r=e.link,o=e.name,s=e.likes.length,n=e._id,a=t(r,o,s,n);e.likes.some((e=>e._id===J))&&a.querySelector(".card__like-button").classList.add("card__like-button_is-active"),e.owner._id!==J&&a.querySelector(".card__delete-button").classList.add("card__delete-button_unactive"),v.append(a)}))})).catch((e=>{console.log(e)})),E.addEventListener("click",(e=>{O.value=L.style.backgroundImage.slice(5,-2),s(D,I),p(f)})),f.addEventListener("submit",(function(e){e.preventDefault(),N.textContent="Сохраняем...",N.classList.add(I.inactiveButtonClass),N.disabled=!0;var t;(t={avatar:O.value},fetch(`${m.baseUrl}/users/me/avatar`,{method:"PATCH",body:JSON.stringify(t),headers:m.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))).then((e=>{L.style.backgroundImage=`url(${e.avatar})`,_(f)})).catch((e=>{console.log(e)})).finally((()=>{N.textContent="Сохранить",N.classList.remove(I.inactiveButtonClass),N.disabled=!1}))})),k.addEventListener("click",(e=>{B.value=b.textContent,P.value=g.textContent,s($,I),p(y)})),$.addEventListener("submit",(function(e){e.preventDefault(),j.textContent="Сохраняем...",j.classList.add(I.inactiveButtonClass),j.disabled=!0;var t;(t={name:B.value,about:P.value},fetch(`${m.baseUrl}/users/me`,{method:"PATCH",body:JSON.stringify(t),headers:m.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))).then((e=>{b.textContent=e.name,g.textContent=e.about,_(y)})).catch((e=>{console.log(e)})).finally((()=>{j.textContent="Сохранить",j.classList.remove(I.inactiveButtonClass),j.disabled=!1}))})),x.addEventListener("click",(()=>{w.value="",U.value="",((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);o.forEach((o=>{r(e,o,t.inputErrorClass,t.errorClass)})),n(o,s,t.inactiveButtonClass)})(T,I),p(h)})),T.addEventListener("submit",(function(e){e.preventDefault(),A.textContent="Создаем...",A.classList.add(I.inactiveButtonClass),A.disabled=!0;var r;(r={name:U.value,link:w.value},fetch(`${m.baseUrl}/cards`,{method:"POST",headers:m.headers,body:JSON.stringify(r)}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))).then((e=>{const r=e.link,o=e.name,s=e.likes.length,n=e._id,a=t(r,o,s,n);v.prepend(a),_(h)})).catch((e=>{console.log(e)})).finally((()=>{A.textContent="Создать",A.classList.remove(I.inactiveButtonClass),A.disabled=!1}))}))})();